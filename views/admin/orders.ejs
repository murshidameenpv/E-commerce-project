<%-include('includes/header')%>
<%-include('includes/sidebar')%>
    <div class="app-wrapper">
	    <div class="app-content pt-3 p-md-3 p-lg-4">
		    <div class="container-xl">		    
			    <div class="row g-3 mb-4 align-items-center justify-content-between">
				    <div class="col-auto">
			            <h1 class="app-page-title mb-0">Orders</h1>
				    </div>
				    <div class="col-auto">
					     <div class="page-utilities">
						    <div class="row g-2 justify-content-start justify-content-md-end align-items-center">
							    <div class="col-auto">
								    <form class="table-search-form row gx-1 align-items-center">
					                    <div class="col-auto">
					                        <input type="text" id="search-orders" name="searchorders" class="form-control search-orders" placeholder="Search">
					                    </div>
					                    <div class="col-auto">
					                        <button type="submit" class="btn app-btn-secondary">Search</button>
					                    </div>
					                </form>
					                
							    </div><!--//col-->
							    <div class="col-auto">
								    
								    <select class="form-select w-auto" >
										  <option selected value="option-1">All</option>
										  <option value="option-2">This week</option>
										  <option value="option-3">This month</option>
										  <option value="option-4">Last 3 months</option>							  
									</select>
							    </div>
						    </div><!--//row-->
					    </div><!--//table-utilities-->
				    </div><!--//col-auto-->
			    </div><!--//row-->
			   
			    
			    <nav id="orders-table-tab" class="orders-table-tab app-nav-tabs nav shadow-sm flex-column flex-sm-row mb-4">
				    <a class="flex-sm-fill text-sm-center nav-link active" id="orders-all-tab" data-bs-toggle="tab" href="#orders-all" role="tab" aria-controls="orders-all" aria-selected="true">All</a>
				    <a class="flex-sm-fill text-sm-center nav-link"  id="orders-rejected-tab" data-bs-toggle="tab" href="#orders-rejected" role="tab" aria-controls="orders-rejected" aria-selected="false">Rejected</a>
				    <a class="flex-sm-fill text-sm-center nav-link" id="orders-processing-tab" data-bs-toggle="tab" href="#orders-processing" role="tab" aria-controls="orders-processing" aria-selected="false">Processing</a>
				    <a class="flex-sm-fill text-sm-center nav-link" id="orders-shipped-tab" data-bs-toggle="tab" href="#orders-shipped" role="tab" aria-controls="orders-shipped" aria-selected="false">Shipped</a>
				    <a class="flex-sm-fill text-sm-center nav-link" id="orders-delivered-tab" data-bs-toggle="tab" href="#orders-delivered" role="tab" aria-controls="orders-delivered" aria-selected="false">Delivered</a>
				    <a class="flex-sm-fill text-sm-center nav-link" id="orders-delivered-tab" data-bs-toggle="tab" href="#orders-canceled" role="tab" aria-controls="orders-canceled" aria-selected="false">Canceled</a>
				</nav>
				
				
				<div class="tab-content" id="orders-table-tab-content">
			        <div class="tab-pane fade show active" id="orders-all" role="tabpanel" aria-labelledby="orders-all-tab">
					    <div class="app-card app-card-orders-table shadow-sm mb-5">
						    <div class="app-card-body">
							    <div class="table-responsive">
								<table class="table app-table-hover mb-0 text-left">
									<thead>
										<tr>
											<th class="cell">Order ID</th>
											<th class="cell">Customer</th>
											<th class="cell">Date</th>
											<th class="cell">Payment</th>
											<th class="cell">Status</th>
											<th class="cell">Cancel</th>
											<th class="cell">Process</th>
											<th class="cell">Ship</th>
											<th class="cell">Deliver</th>
											<th class="cell">Details</th>
										</tr>
									</thead>
									<tbody>
										<% orders.forEach(order=> { %>
											<tr>
												<td class="cell">
													<%= order._id.toString().slice(-5) %>
												</td>
												<td class="cell"><span class="truncate">
														<%= order.user.name %>
													</span></td>
												<td class="cell">
													<span>
														<%= order.createdAt.toLocaleDateString() %>
													</span>
													<span class="note">
														<%= order.createdAt.toLocaleTimeString() %>
													</span>
												</td>
												<td class="cell">
													<%= order.payment_method %>
												</td>
									<td class="cell">
										<% if (order.status==='Placed' ) { %>
											<span class="badge bg-blue">
												<%= order.status %>
											</span>
											<% } else if (order.status==='Processing' ) { %>
												<span class="badge bg-warning">
													<%= order.status %>
												</span>
												<% } else if (order.status==='Shipped' ) { %>
													<span class="badge bg-secondary">
														<%= order.status %>
													</span>
													<% } else if (order.status==='Delivered' ) { %>
														<span class="badge bg-success">
															<%= order.status %>
														</span>
														<% } else if (order.status==='Rejected' ) { %>
															<span class="badge bg-orange">
																<%= order.status %>
															</span>
														<% } else if (order.status==='Canceled' ) { %>
															<span class="badge bg-danger">
																<%= order.status %>
															</span>
															<% } else { %>
																<%= order.status %>
																	<% } %>
									</td>

									<td class="cell">
										<% if (order.status==='Shipped' ||order.status==='Processing' || order.status==='Delivered' || order.status==='Rejected' || order.status==='Canceled' ) { %>
											<button type="button" class="btn btn-danger" disabled>Reject</button>
											<% } else { %>
												<button type="button" class="btn btn-danger" data-bs-toggle="modal"
													data-bs-target="#rejectOrderModal_<%= order._id %>" data-order-id="<%= order._id %>">Reject</button>
												<% } %>
									</td>
									
									<td class="cell">
										<% if (order.status==='Processing' || order.status==='Shipped' || order.status==='Delivered' || order.status==='Rejected' || order.status==='Canceled' ) { %>
											<button type="button" class="btn btn-warning" disabled>Process</button>
											<% } else { %>
												<button type="button" class="btn btn-warning" onclick="processOrder('<%= order._id %>')">Process</button>
												<% } %>
									</td>
									
									<td class="cell">
										<% if (order.status==='Placed'|| order.status==='Shipped' || order.status==='Delivered' || order.status==='Rejected' || order.status==='Canceled'  ) { %>
											<button type="button" class="btn btn-secondary" disabled>Ship</button>
											<% } else { %>
												<button type="button" class="btn btn-secondary" onclick="shipOrder('<%= order._id %>')">Ship</button>
												<% } %>
									</td>
									
									<td class="cell">
										<% if (order.status==='Placed' || order.status==='Processing' || order.status==='Delivered' || order.status==='Rejected' || order.status==='Canceled' ) { %>
											<button type="button" class="btn btn-primary" disabled>Deliver</button>
											<% } else { %>
												<button type="button" class="btn btn-primary" onclick="deliverOrder('<%= order._id %>')">Deliver</button>
												<% } %>
									</td>

											
												<td class="cell">
															<span style="cursor: pointer" onclick="viewOrder('<%= order._id %>')"><i class="fa fa-eye"></i>
																View</span>
												</td>
											</tr>
											<% }) %>
									</tbody>

								</table>

						        </div><!--//table-responsive-->
						       
						    </div><!--//app-card-body-->		
						</div><!--//app-card-->
						<nav class="app-pagination">
							<ul class="pagination justify-content-center">
								<li class="page-item disabled">
									<a class="page-link" href="#" tabindex="-1" aria-disabled="true">Previous</a>
							    </li>
								<li class="page-item active"><a class="page-link" href="#">1</a></li>
								<li class="page-item"><a class="page-link" href="#">2</a></li>
								<li class="page-item"><a class="page-link" href="#">3</a></li>
								<li class="page-item">
								    <a class="page-link" href="#">Next</a>
								</li>
							</ul>
						</nav><!--//app-pagination-->
						
			        </div><!--//tab-pane-->
			        
			        <div class="tab-pane fade" id="orders-rejected" role="tabpanel" aria-labelledby="orders-rejected-tab">
					    <div class="app-card app-card-orders-table mb-5">
						    <div class="app-card-body">
							    <div class="table-responsive">
								    
							        <table class="table mb-0 text-left">
										<thead>
											<tr>
												<th class="cell">Order ID</th>
												<th class="cell">Customer</th>
												<th class="cell">Date</th>
												<th class="cell">Payment</th>
												<th class="cell">Status</th>
												<th class="cell">Refund</th>
												<th class="cell">Details</th>
											</tr>
										</thead>
										<tbody>
											<% rejectedOrder.forEach(order=> { %>
											<tr>
												<td class="cell"><%= order._id.toString().slice(-5) %></td>
												<td	 class="cell"><span class="truncate"><%= order.user.name %></span></td>
												<td class="cell"><span><%= order.createdAt.toLocaleDateString() %></span><span class="note"><%= order.createdAt.toLocaleTimeString() %></span></td>
												<td class="cell">
													<%= order.payment_method %>
												</td>
												<td class="cell">
													<span class="badge bg-orange">
														<%= order.status %>
													</span>
												</td>
												<td class="cell">
													<button type="button" class="btn btn-primary" onclick="refundOrder('<%= order._id %>')">Refund</button>
												</td>

												<td class="cell">
													<span style="cursor: pointer" onclick="viewOrder('<%= order._id %>')"><i class="fa fa-eye"></i>
														View</span>
												</td>
											</tr>
										</tbody>
										<% }) %>
									</table>
						        </div><!--//table-responsive-->
						    </div><!--//app-card-body-->		
						</div><!--//app-card-->
			        </div><!--//tab-pane-->
			        
			        <div class="tab-pane fade" id="orders-processing" role="tabpanel" aria-labelledby="orders-processing-tab">
					    <div class="app-card app-card-orders-table mb-5">
						    <div class="app-card-body">
							    <div class="table-responsive">
									<table class="table mb-0 text-left">
										<thead>
											<tr>
												<th class="cell">Order ID</th>
												<th class="cell">Customer</th>
												<th class="cell">Date</th>
												<th class="cell">Payment</th>
												<th class="cell">Status</th>
												<th class="cell">Ship</th>
												<th class="cell">Details</th>
											</tr>
										</thead>
										<tbody>
											<% processingOrder.forEach(order=> { %>
												<tr>
													<td class="cell">
														<%= order._id.toString().slice(-5) %>
													</td>
													<td class="cell"><span class="truncate">
															<%= order.user.name %>
														</span></td>
													<td class="cell"><span>
															<%= order.createdAt.toLocaleDateString() %>
														</span><span class="note">
															<%= order.createdAt.toLocaleTimeString() %>
														</span></td>
													<td class="cell">
														<%= order.payment_method %>
													</td>
													<td class="cell">
														<span class="badge bg-warning">
															<%= order.status %>
														</span>
													</td>
													<td class="cell">
														<button type="button" class="btn btn-secondary" onclick="shipOrder('<%= order._id %>')">Ship</button>
													</td>
													<td class="cell">
														<span style="cursor: pointer" onclick="viewOrder('<%= order._id %>')"><i class="fa fa-eye"></i>
															View</span>
													</td>
												</tr>
										</tbody>
										<% }) %>
									</table>
						        </div><!--//table-responsive-->
						    </div><!--//app-card-body-->		
						</div><!--//app-card-->
			        </div><!--//tab-pane-->


			        <div class="tab-pane fade" id="orders-shipped" role="tabpanel" aria-labelledby="orders-shipped-tab">
					    <div class="app-card app-card-orders-table mb-5">
						    <div class="app-card-body">
							    <div class="table-responsive">
									<table class="table mb-0 text-left">
										<thead>
											<tr>
												<th class="cell">Order ID</th>
												<th class="cell">Customer</th>
												<th class="cell">Date</th>
												<th class="cell">Payment</th>
												<th class="cell">Status</th>
												<th class="cell">Deliver</th>
												<th class="cell">Details</th>
											</tr>
										</thead>
										<tbody>
											<% shippedOrder.forEach(order=> { %>
												<tr>
													<td class="cell">
														<%= order._id.toString().slice(-5) %>
													</td>
													<td class="cell"><span class="truncate">
															<%= order.user.name %>
														</span></td>
													<td class="cell"><span>
															<%= order.createdAt.toLocaleDateString() %>
														</span><span class="note">
															<%= order.createdAt.toLocaleTimeString() %>
														</span></td>
													<td class="cell">
														<%= order.payment_method %>
													</td>
													<td class="cell">
														<span class="badge bg-secondary">
															<%= order.status %>
														</span>
													</td>
													<td class="cell">
														<button type="button" class="btn btn-primary"
															onclick="deliverOrder('<%= order._id %>')">Ship</button>
													</td>
													<td class="cell">
														<span style="cursor: pointer" onclick="viewOrder('<%= order._id %>')"><i class="fa fa-eye"></i>
															View</span>
													</td>
												</tr>
										</tbody>
										<% }) %>
									</table>
						        </div><!--//table-responsive-->
						    </div><!--//app-card-body-->		
						</div><!--//app-card-->
			        </div><!--//tab-pane-->

					<div class="tab-pane fade" id="orders-delivered" role="tabpanel" aria-labelledby="orders-delivered-tab">
						<div class="app-card app-card-orders-table mb-5">
							<div class="app-card-body">
								<div class="table-responsive">
									<table class="table mb-0 text-left">
										<thead>
											<tr>
												<th class="cell">Order ID</th>
												<th class="cell">Customer</th>
												<th class="cell">Date</th>
												<th class="cell">Payment</th>
												<th class="cell">Status</th>
												<th class="cell">Details</th>
											</tr>
										</thead>
										<tbody>
											<% deliveredOrder.forEach(order=> { %>
												<tr>
													<td class="cell">
														<%= order._id.toString().slice(-5) %>
													</td>
													<td class="cell"><span class="truncate">
															<%= order.user.name %>
														</span></td>
													<td class="cell"><span>
															<%= order.createdAt.toLocaleDateString() %>
														</span><span class="note">
															<%= order.createdAt.toLocaleTimeString() %>
														</span></td>
													<td class="cell">
														<%= order.payment_method %>
													</td>
													<td class="cell">
														<span class="badge bg-primary">
															<%= order.status %>
														</span>
													</td>
													<td class="cell">
														<span style="cursor: pointer" onclick="viewOrder('<%= order._id %>')"><i class="fa fa-eye"></i>
															View</span>
													</td>
												</tr>
										</tbody>
										<% }) %>
									</table>
								</div><!--//table-responsive-->
							</div><!--//app-card-body-->
						</div><!--//app-card-->
					</div><!--//tab-pane-->

					<div class="tab-pane fade" id="orders-canceled" role="tabpanel" aria-labelledby="orders-canceled-tab">
						<div class="app-card app-card-orders-table mb-5">
							<div class="app-card-body">
								<div class="table-responsive">
									<table class="table mb-0 text-left">
										<thead>
											<tr>
												<th class="cell">Order ID</th>
												<th class="cell">Customer</th>
												<th class="cell">Date</th>
												<th class="cell">Payment</th>
												<th class="cell">Status</th>
												<th class="cell">Refund</th>
												<th class="cell">Details</th>
											</tr>
										</thead>
										<tbody>
											<% canceledOrder.forEach(order=> { %>
												<tr>
													<td class="cell">
														<%= order._id.toString().slice(-5) %>
													</td>
													<td class="cell"><span class="truncate">
															<%= order.user.name %>
														</span></td>
													<td class="cell"><span>
															<%= order.createdAt.toLocaleDateString() %>
														</span><span class="note">
															<%= order.createdAt.toLocaleTimeString() %>
														</span></td>
													<td class="cell">
														<%= order.payment_method %>
													</td>
													<td class="cell">
														<span class="badge bg-danger">
															<%= order.status %>
														</span>
													</td>
													<td class="cell">
														<button type="button" class="btn btn-primary"
															onclick="refundOrder('<%= order._id %>')">Refund</button>
													</td>
									
													<td class="cell">
														<span style="cursor: pointer" onclick="viewOrder('<%= order._id %>')"><i class="fa fa-eye"></i>
															View</span>
													</td>
												</tr>
										</tbody>
										<% }) %>
									</table>
								</div><!--//table-responsive-->
							</div><!--//app-card-body-->
						</div><!--//app-card-->
					</div><!--//tab-pane-->
					
				</div><!--//tab-content-->    
		    </div><!--//container-fluid-->
	    </div><!--//app-content-->
    </div><!--//app-wrapper-->    	

//REJECT ORDER MODAL
<% orders.forEach(order=> { %>
<div class="modal fade" id="rejectOrderModal_<%= order._id %>" tabindex="-1" aria-labelledby="rejectOrderModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="rejectOrderModalLabel">Reason to Reject</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
				
					<div class="mb-3">
						<label for="reasonToReject" class="form-label">Reason to Reject</label>
						<input type="text" class="form-control" id="reasonToReject" name="reason" required>
					</div>
					<button type="button" class="btn btn-primary" data-order-id="<%= order._id %>">Submit</button>
					<div id="rejectMessageStatus" class="alert" style="display: none;"></div>
			</div>
		</div>
	</div>
</div>
<% }) %>

	
<%-include('includes/footer')%>


