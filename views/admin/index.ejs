<%-include('includes/header')%>
    <%-include('includes/sidebar')%>
        <div class="app-wrapper">
            <div class="app-content pt-3 p-md-3 p-lg-4">
                <div class="container-xl">
                    <h1 class="app-page-title">Overview</h1>
                    <div class="row g-4 mb-4">
                        <div class="col-6 col-lg-3">
                            <div class="app-card app-card-stat shadow-sm h-100">
                                <div class="app-card-body p-3 p-lg-4">
                                    <h4 class="stats-type mb-1">Total Sales</h4>
                                    <div class="stats-figure">$<%= totalAmount %>
                                    </div>
                                    <div class="stats-meta text-success">
                                        <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-arrow-up"
                                            fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                            <path fill-rule="evenodd"
                                                d="M8 15a.5.5 0 0 0 .5-.5V2.707l3.146 3.147a.5.5 0 0 0 .708-.708l-4-4a.5.5 0 0 0-.708 0l-4 4a.5.5 0 1 0 .708.708L7.5 2.707V14.5a.5.5 0 0 0 .5.5z" />
                                        </svg> 20%
                                    </div>
                                </div><!--//app-card-body-->
                                <a class="app-card-link-mask" href="#"></a>
                            </div><!--//app-card-->
                        </div><!--//col-->
                        <div class="col-6 col-lg-3">
                            <div class="app-card app-card-stat shadow-sm h-100">
                                <div class="app-card-body p-3 p-lg-4">
                                    <h4 class="stats-type mb-1">Total Orders</h4>
                                    <div class="stats-figure">
                                        <%= deliveredOrderCount %>
                                    </div>
                                </div><!--//app-card-body-->
                                <a class="app-card-link-mask" href="#"></a>
                            </div><!--//app-card-->
                        </div><!--//col-->
                        <div class="col-6 col-lg-3">
                            <div class="app-card app-card-stat shadow-sm h-100">
                                <div class="app-card-body p-3 p-lg-4">
                                    <h4 class="stats-type mb-1">Total Customers</h4>
                                    <div class="stats-figure">
                                        <%= userCount %>
                                    </div>
                                </div><!--//app-card-body-->
                                <a class="app-card-link-mask" href="#"></a>
                            </div><!--//app-card-->
                        </div><!--//col-->
                    </div><!--//row-->

                    <div class="row g-4 mb-4">
                        <div class="app-content pt-3 p-md-3 p-lg-4">
                            <div class="container-xl" style="height: 300px; overflow-y: scroll;">
                                <div class="row g-3 mb-4 align-items-center justify-content-between">
                                    <div class="col-auto">
                                       
                                    </div>
                                    <div class="col-auto">
                                        <div class="page-utilities">
                                            <div
                                                class="row g-2 justify-content-start justify-content-md-end align-items-center">
                                                <div class="col-auto">
                                                  
                                                </div>
                                                <div class="col-auto">

                                                </div>
                                            </div><!--//row-->
                                        </div><!--//table-utilities-->
                                    </div><!--//col-auto-->
                                </div><!--//row-->

                                <div class="tab-content" id="dashboard-table-tab-content">
                                    <div class="app-card app-card-orders-table shadow-sm mb-5">
                                        <div class="app-card-body" id="dashboardTable">
                                            <div class="table-responsive">
                                                <table class="table app-table-hover mb-0 text-left" id="table_dashboard">
                                                    <thead>
                                                        <tr>
                                                            <th class="cell">No</th>
                                                            <th class="cell">Date</th>
                                                            <th class="cell">Order Id</th>
                                                            <th class="cell">Name</th>
                                                            <th class="cell">Amount</th>
                                                            <th class="cell">Payment</th>

                                                        </tr>
                                                    </thead>
                                                        <tbody>
                                                            <% deliveredOrders.forEach((order,index)=> { %>
                                                                <tr>
                                                                    <td class="cell">
                                                                        <%= index+1 %>
                                                                    </td>
                                                                    <td class="cell">
                                                                        <%= order.deliveredAt.toDateString() %>
                                                                    </td>
                                                                    <td class="cell">
                                                                        <%= order._id %>
                                                                    </td>
                                                                    <td class="cell">
                                                                        <%= order.user.name %>
                                                                    </td>
                                                                    <td class="cell">
                                                                        <%= order.total %>
                                                                    </td>
                                                                    <td class="cell">
                                                                        <%= order.payment_method %>
                                                                    </td>
                                                                </tr>
                                                                <% }) %>
                                                        </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row g-4 mb-4">
                        <div class="col-12 col-lg-6">
                            <div class="app-card app-card-chart h-100 shadow-sm">
                                <div class="app-card-header p-3">
                                    <div class="row justify-content-between align-items-center">
                                        <div class="col-auto">
                                            <h4 class="app-card-title">Sales</h4>
                                        </div><!--//col-->
                                    </div><!--//row-->
                                </div><!--//app-card-header-->
                                <div class="app-card-body p-3 p-lg-4">
                                    <div class="chart-container">
                                        <canvas id="canvas-linechart"></canvas>
                                    </div>
                                </div><!--//app-card-body-->
                            </div><!--//app-card-->
                        </div><!--//col-->
                       
                                            <div class="col-12 col-lg-6">
                                                <div class="app-card app-card-chart h-100 shadow-sm">
                                                    <div class="app-card-header p-3">
                                                        <div class="row justify-content-between align-items-center">
                                                            <div class="col-auto">
                                                                <h4 class="app-card-title">Statistics</h4>
                                                            </div><!--//col-->
                                                        </div><!--//row-->
                                                    </div><!--//app-card-header-->
                                                    <div class="app-card-body p-3 p-lg-4">
                                                        <div class="chart-container">
                                                            <canvas id="chart-pie"></canvas>
                                                        </div>
                                                    </div><!--//app-card-body-->
                                                </div><!--//app-card-->
                                            </div><!--//col-->
                        
                        </div><!--//col-->
                    </div><!--//row-->
                </div><!--//container-fluid-->
            </div><!--//app-content-->
        </div><!--//app-wrapper-->
        <script>
            
                window.chartColors = {
                    green: '#75c181',
                    gray: '#a9b5c9',
                    text: '#252930',
                    border: '#e7e9ed',
                    blue:'#0c6bca',
                    red:'#ca4e62',
                    yellow:'#b0ad17'
                };

               

                //Chart.js Line Chart Example 

                var lineChartConfig = {
                    type: 'line',

                    data: {
                        labels: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],

                        datasets: [{
                            label: 'Current week',
                            fill: false,
                            backgroundColor: window.chartColors.green,
                            borderColor: window.chartColors.green,
                            data: [<%= currentWeekSalesArray%>],
                        }, {
                            label: 'Previous week',
                            borderDash: [3, 5],
                            backgroundColor: window.chartColors.gray,
                            borderColor: window.chartColors.gray,

                            data:  [<%= prevWeekSalesArray %>],
                            fill: false,
                        }]
                    },
                    options: {
                        responsive: true,
                        aspectRatio: 1.5,

                        legend: {
                            display: true,
                            position: 'bottom',
                            align: 'end',
                        },

                        title: {
                            display: true,
                            text: 'Statistics of total sales in current week and previous week',

                        },
                        tooltips: {
                            mode: 'index',
                            intersect: false,
                            titleMarginBottom: 10,
                            bodySpacing: 10,
                            xPadding: 16,
                            yPadding: 16,
                            borderColor: window.chartColors.border,
                            borderWidth: 1,
                            backgroundColor: '#fff',
                            bodyFontColor: window.chartColors.text,
                            titleFontColor: window.chartColors.text,

                            callbacks: {
                                //Ref: https://stackoverflow.com/questions/38800226/chart-js-add-commas-to-tooltip-and-y-axis
                                label: function (tooltipItem, data) {
                                    if (parseInt(tooltipItem.value) >= 1000) {
                                        return "$" + tooltipItem.value.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
                                    } else {
                                        return '$' + tooltipItem.value;
                                    }
                                }
                            },

                        },
                        hover: {
                            mode: 'nearest',
                            intersect: true
                        },
                        scales: {
                            xAxes: [{
                                display: true,
                                gridLines: {
                                    drawBorder: false,
                                    color: window.chartColors.border,
                                },
                                scaleLabel: {
                                    display: false,

                                }
                            }],
                            yAxes: [{
                                display: true,
                                gridLines: {
                                    drawBorder: false,
                                    color: window.chartColors.border,
                                },
                                scaleLabel: {
                                    display: false,
                                },
                                ticks: {
                                    beginAtZero: true,
                                    userCallback: function (value, index, values) {
                                        return '$' + value.toLocaleString();   //Ref: https://stackoverflow.com/questions/38800226/chart-js-add-commas-to-tooltip-and-y-axis
                                    }
                                },
                            }]
                        }
                    }
                };



                // Pie Chart Demo

                var pieChartConfig = {
                    type: 'pie',
                    data: {
                        datasets: [{
                            data: [
                               <%=placedCount%>,
                               <%=deliveredCount%>,
                               <%=processingCount %>,
                               <%=shippedCount %>,
                                <%=cancelledCount%>,
                                
                                
                            ],
                            backgroundColor: [
                                window.chartColors.blue,
                                window.chartColors.green,
                                window.chartColors.yellow,
                                window.chartColors.gray,
                                window.chartColors.red,

                            ],
                            label: 'Dataset 1'
                        }],
                        labels: [
                            'Placed',
                            'Delivered',
                            'processing',
                            'Shipped',
                            'Cancelled',
                        ]
                    },
                    options: {
                        responsive: true,
                        legend: {
                            display: true,
                            position: 'bottom',
                            align: 'center',
                        },
                         title: {
                            display: true,
                            text: 'Statistics of orders',

                        },

                        tooltips: {
                            titleMarginBottom: 10,
                            bodySpacing: 10,
                            xPadding: 16,
                            yPadding: 16,
                            borderColor: window.chartColors.border,
                            borderWidth: 1,
                            backgroundColor: '#fff',
                            bodyFontColor: window.chartColors.text,
                            titleFontColor: window.chartColors.text,

                            /* Display % in tooltip - https://stackoverflow.com/questions/37257034/chart-js-2-0-doughnut-tooltip-percentages */
                            callbacks: {
                                label: function (tooltipItem, data) {
                                    //get the concerned dataset
                                    var dataset = data.datasets[tooltipItem.datasetIndex];
                                    //calculate the total of this data set
                                    var total = dataset.data.reduce(function (previousValue, currentValue, currentIndex, array) {
                                        return previousValue + currentValue;
                                    });
                                    //get the current items value
                                    var currentValue = dataset.data[tooltipItem.index];
                                    //calculate the precentage based on the total and current item, also this does a rough rounding to give a whole number
                                    var percentage = Math.floor(((currentValue / total) * 100) + 0.5);

                                    return percentage + "%";
                                },
                            },


                        },
                    }
                };








                // Generate charts on load
                window.addEventListener('load', function () {

                    var lineChart = document.getElementById('canvas-linechart').getContext('2d');
                    window.myLine = new Chart(lineChart, lineChartConfig);

                    var pieChart = document.getElementById("chart-pie").getContext("2d");
                    window.myPie = new Chart(pieChart, pieChartConfig);
                });	
            
                
        </script>
        <%-include('includes/footer')%>